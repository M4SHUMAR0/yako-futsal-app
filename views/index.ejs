<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- サイズはiphone12Pro(390×844px)を想定 -->
    <title>出欠管理の看板</title>
    <!-- todo:css/jsファイルのパスを指定する -->
    <link rel="stylesheet" href="/css/index.css">
</head>
<body>
    <h1>矢向フットサル部<br>出欠管理の看板</h1>

    <% console.log(people); %>
    <% people.forEach((person,index) => {console.log(index); console.log(person.name)}) %>    
    <div class = "tripleColumn">
        <!-- TODO:forEach文を用いてコードの短縮化をする -->
        <% people.forEach((person,index) => { %>
            <div class ="firstColumn">
                <% if (index < 7) { %>
                    <div class = "block">
                        <div class = "person">
                            <p> <%= person.name %> </p>
                        </div>
                        <div class = "car">
                            <p> <%= person.car %> </p>
                        </div>
                        <div class = "attendance">
                            <p class ="yes">出席</p>
                            <p class ="no unvisible">欠席</p>
                        </div>
                        <a href="#"><button class="btn"><span>出席/欠席</span></button></a>
                    </div>
                <% } %>
            </div>
            <div class ="secondColumn">
                <% if((7 <= index) && (index < 14)){ %>
                    <div class = "block">
                        <div class = "person">
                            <p> <%= person.name %> </p>
                        </div>
                        <div class = "car">
                            <p> <%= person.car %> </p>
                        </div>
                        <div class = "attendance">
                            <p class ="yes">出席</p>
                            <p class ="no unvisible">欠席</p>
                        </div>
                        <a href="#"><button class="btn"><span>出席/欠席</span></button></a>
                    </div>
                <% } %>
            </div>
            <div class ="thirdColumn">
                <% if((14 <= index) && (index < 21)){ %>
                    <div class = "block">
                        <div class = "person">
                            <p> <%= person.name %> </p>
                        </div>
                        <div class = "car">
                            <p> <%= person.car %> </p>
                        </div>
                        <div class = "attendance">
                            <p class ="yes">出席</p>
                            <p class ="no unvisible">欠席</p>
                        </div>
                        <a href="#"><button class="btn"><span>出席/欠席</span></button></a>
                    </div>
            </div>
                <% } %>
        <% }) %>  
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        window.addEventListener('load', function(){
            // サーバーへ接続
            const socket = io();
            
            socket.emit('sendMessage', "testmessage");
            socket.on('receiveMessage', (message) => {
                // messageには受信したメッセージが入る
                console.log(message);
            });

            const btnElems = document.getElementsByClassName("btn");
            const yesElems = document.getElementsByClassName("yes");
            const noElems = document.getElementsByClassName("no");
            Array.prototype.forEach.call(btnElems, function(btnElem,index){
                btnElem.addEventListener("click",function(){
                    const yesElem = yesElems[index];
                    const noElem = noElems[index];

                    yesElem.classList.toggle("unvisible");
                    noElem.classList.toggle("unvisible");

                    socket.emit('sendMessage', "testmessage");
                    socket.on('receiveMessage', (message) => {
                        // messageには受信したメッセージが入る
                        console.log(message);
                    });                    
                })
            })

        });
    </script>
</body>
</html>